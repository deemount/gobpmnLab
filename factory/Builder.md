# Builder

## Reflection-based Dependency Injection in a Interface

Here's a high-level overview of the algorithm:

1. Reflection: The algorithm uses Go's reflection capabilities to inspect the structure of the provided interface. It identifies fields, their types, and their values.

2. Dependency Injection: The algorithm injects dependencies into the provided interface. In this case, the dependencies are hash values generated by the hash function. These hash values are injected into fields of the struct based on certain conditions.

3. Hash Generation: The hash function generates a hash value using the FNV-32a variant of the Fowler–Noll–Vo hash function. It also uses a random number as input to the hash function to ensure uniqueness.

4. Field Analysis: The algorithm analyzes the fields of the struct. It checks if they are anonymous, if they are of type Builder, if they are boolean, and if they contain certain words. Based on these checks, it performs different actions.

5. Field Injection: The algorithm injects hash values into the fields of the struct. It handles boolean fields and struct fields differently. It also checks and handles the previous and next fields.

6. Counting Elements: The algorithm counts certain elements in the struct, such as pools, messages, start events, tasks, and end events. This is done in the countPool, countMessage, countStartEvent, countTask, and countEndEvent methods.

7. Error Handling: The algorithm uses a deferred function to recover from panics that might occur during the injection process. This ensures that the program doesn't crash if there's an error during injection.

This algorithm allows for dynamic dependency injection based on the structure of the provided interface, making it flexible and adaptable to different structures.

## Injection Rules

The injection rules for anonymous fields in the Builder struct are implemented in the inject method. Here's a brief description:

1. Check for Anonymous Fields: The method first checks if the struct has any anonymous fields using the hasAnonymous method. If there are anonymous fields, it proceeds with the injection process.

2. Iterate Over Anonymous Fields: For each anonymous field, the method retrieves the reflected value of the field and creates a map and a slice to hold field data and hash values respectively.

3. Iterate Over Field Values: The method then iterates over the values of the fields assigned to the anonymous field. Depending on the kind of the field (boolean or struct), different actions are taken:

* Boolean Fields: If the field is a boolean and it's the first field, it's set to true. All other boolean fields are set to false.

* Struct Fields: If the field is a struct, it's injected with a hash value. The hash value is generated by the hash method. If the struct field already has a hash value, it's not injected again. The method also checks the previous and next fields and sets their hash values accordingly.

1. No Anonymous Fields: If the struct does not have any anonymous fields, the method iterates over the builder fields and injects them with a hash value. It also sets the boolean fields to true.

This process ensures that each field in the struct, whether it's an anonymous field or not, is injected with a unique hash value. This can be useful for identifying fields or ensuring uniqueness.
